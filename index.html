<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>WebXR Plane Cube</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene embedded xrweb="requiredFeatures: hit-test">
      <a-box id="cube" color="#4CC3D9" scale="0.2 0.2 0.2"></a-box>
      <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');
      const cube = document.querySelector('#cube');

      scene.addEventListener('enter-vr', async () => {
        const session = scene.renderer.xr.getSession();
        if (!session) return;

        const viewerSpace = await session.requestReferenceSpace('viewer');
        const hitTestSource = await session.requestHitTestSource({ space: viewerSpace });

        session.addEventListener('end', () => hitTestSource.cancel());

        scene.renderer.setAnimationLoop((time, frame) => {
          if (!frame) return;

          const hitTestResults = frame.getHitTestResults(hitTestSource);
          if (hitTestResults.length > 0) {
            const hit = hitTestResults[0];
            const pose = hit.getPose(scene.renderer.xr.getReferenceSpace());
            if (pose) {
              cube.object3D.position.set(
                pose.transform.position.x,
                pose.transform.position.y,
                pose.transform.position.z
              );
            }
          }
        });
      });
    </script>
  </body>
</html>
